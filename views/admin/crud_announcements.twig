<style>
    table, tr, th, td {
        border: 1px solid black;
        border-collapse: collapse;
        padding: 10px;
        text-align: center;
        max-width: 100vw;
    }

    td {
        text-align: left;
    }
</style>

<table id="editable-table">
    <!-- Initial table content -->
    <thead>
    <tr>
        <th>Title</th>
        <th>Contents</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    {% for value in data %}
        <tr>
            <td contenteditable="true">{{ value[0]|raw }}</td>
            <td contenteditable="true">{{ value[1]|raw }}</td>
            <td><button class="delete-row">Delete</button></td>
        </tr>
    {% endfor %}
    </tbody>
</table>
<button id="add-row">Add Row</button>
<button id="submit-table">Submit</button>

<script src="{{ js('jquery.js') }}"></script>
<script>
    $(document).ready(function () {
        function addRow() {
            let newRow = '<tr>' +
                '<td contenteditable="true"></td>' +
                '<td contenteditable="true"></td>' +
                '<td><button class="delete-row">Delete</button></td>' +
                '</tr>';
            $('#editable-table tbody').append(newRow);
        }

        function deleteRow() {
            $(this).closest('tr').remove();
        }

        // Add row button click event
        $('#add-row').on('click', addRow);

        // Delete row button click event
        $('#editable-table').on('click', '.delete-row', deleteRow);

        $('#submit-table').on('click', function () {
            let data = [];
            $('#editable-table tbody tr').each(function () {
                let row = [];
                $(this).find('td').each(function () {
                    row.push($(this).text())
                });
                data.push(row);
            });

            $.ajax({
                url: '/crud_announcements',
                method: 'POST',
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify({data}),
                success: function (res) {
                    if (res.success) {
                        alert(`Announcements updated successfully!`);
                    } else {
                        alert('Announcements failed to be updated (Internal server error)');
                    }
                },
                error: function (e) {
                    alert(`Announcements failed to be updated. (Ajax error)`);
                    console.error(e);
                }
            }).then(function () {
                location.reload();
            });
        });
    });
</script>